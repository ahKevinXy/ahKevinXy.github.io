<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-backend/go/interview/expends" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">面试 拓展 | ahKevinXy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://study.opencodes.top/docs/backend/go/interview/expends"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="keywords" content="blog,Go,学习,前端学习,技术分享,后端学习,博客"><meta data-rh="true" name="keywords" content="ahKevinXy"><meta data-rh="true" name="msvalidate.01" content="6642F3D5D5529FA5AEA94994FFA85FD9"><meta data-rh="true" name="google-site-verification" content="OjdXl-LQVipK7iEmiPYU3EZdnALZ9_hV3sQfL4cpwYo"><meta data-rh="true" name="yandex-verification" content="3b18521c6bba1227"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="面试 拓展 | ahKevinXy"><meta data-rh="true" name="description" content="讲讲 Go 的 select 底层数据结构和一些特性"><meta data-rh="true" property="og:description" content="讲讲 Go 的 select 底层数据结构和一些特性"><link data-rh="true" rel="icon" href="/static/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://study.opencodes.top/docs/backend/go/interview/expends"><link data-rh="true" rel="alternate" href="https://study.opencodes.top/docs/backend/go/interview/expends" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://study.opencodes.top/docs/backend/go/interview/expends" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ahKevinXy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ahKevinXy Atom Feed">

<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=G-RXDN42SD0T",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>


<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>


<link rel="icon" href="/img/headers.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/antd/5.6.1/reset.min.css">
<script src="https://hm.baidu.com/hm.js?d6e0cd2ae2743facfaf5458546a77110" async></script>
<script src="/js/custom.js" async></script>
<script src="https://hm.baidu.com/hm.js?8e4dc294692bce77851a59a5a4c14947" async></script>
<script src="https://analytics.umami.is/script.js" data-website-id="40cdf814-d784-4576-be2b-0807664d663a"></script>
<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1103221225044644" async crossorigin="anonymous"></script><link rel="stylesheet" href="/assets/css/styles.7e579b13.css">
<link rel="preload" href="/assets/js/runtime~main.0952e668.js" as="script">
<link rel="preload" href="/assets/js/main.660c0253.js" as="script">
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-RXDN42SD0T" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/headers.png" alt="ahKevinXy Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/headers.png" alt="ahKevinXy Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">ahKevinXy</b></a><a class="navbar__item navbar__link" href="/docs/front">前端</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/backend">后端</a><a class="navbar__item navbar__link" href="/docs/game">游戏</a><a class="navbar__item navbar__link" href="/docs/big-data">大数据</a><a class="navbar__item navbar__link" href="/docs/ai">人工智能</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/blog">博客</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/blog/archive">归档</a></li><li><a class="dropdown__link" href="/blog/tags">标签</a></li><li><a class="dropdown__link" href="/search">检索</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">工具</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/tools">开发工具</a></li><li><a class="dropdown__link" href="/website">网站导航</a></li><li><a class="dropdown__link" href="/password">密码生成器</a></li><li><a class="dropdown__link" href="/images">图库</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/updates">更新日志</a><a href="https://github.com/ahKevinXy" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/headers.png" alt="ahKevinXy Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/headers.png" alt="ahKevinXy Logo" class="themedImage_ToTc themedImage--dark_i4oU"><b>ahKevinXy</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/ai">人工智能</a><button aria-label="打开/收起侧边栏菜单「人工智能」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/algo">数据结构与算法</a><button aria-label="打开/收起侧边栏菜单「数据结构与算法」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/backend">后端学习</a><button aria-label="打开/收起侧边栏菜单「后端学习」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/base">基础知识</a><button aria-label="打开/收起侧边栏菜单「基础知识」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/backend/c/struct">c</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/database">数据库</a><button aria-label="打开/收起侧边栏菜单「数据库」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/docker">docker</a><button aria-label="打开/收起侧边栏菜单「docker」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/docs">后端技术文档</a><button aria-label="打开/收起侧边栏菜单「后端技术文档」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/git">git</a><button aria-label="打开/收起侧边栏菜单「git」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/backend/go">Go</a><button aria-label="打开/收起侧边栏菜单「Go」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/go/base">Go 语言基础</a><button aria-label="打开/收起侧边栏菜单「Go 语言基础」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backend/go/blog">文章</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/go/book">开源书籍</a><button aria-label="打开/收起侧边栏菜单「开源书籍」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backend/go/cmd">Go 命令行</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/go/code">Go代码片段</a><button aria-label="打开/收起侧边栏菜单「Go代码片段」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/go/day">每日一库</a><button aria-label="打开/收起侧边栏菜单「每日一库」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/go/doc">第三方文档</a><button aria-label="打开/收起侧边栏菜单「第三方文档」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/go/gin">Gin 框架</a><button aria-label="打开/收起侧边栏菜单「Gin 框架」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/backend/go/interview">面试</a><button aria-label="打开/收起侧边栏菜单「面试」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backend/go/interview/base">Go 面试基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/backend/go/interview/expends">面试 拓展</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/go/note">每日笔记</a><button aria-label="打开/收起侧边栏菜单「每日笔记」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backend/go/offical">官方文档</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backend/go/pkg">深入理解 go sync.Cond</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backend/go/secure">secure</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/go/source">源码学习</a><button aria-label="打开/收起侧边栏菜单「源码学习」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backend/go/test">测试</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/go/tools">工具</a><button aria-label="打开/收起侧边栏菜单「工具」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backend/go/version">版本更新</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/java">Java</a><button aria-label="打开/收起侧边栏菜单「Java」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/logs">日志管理</a><button aria-label="打开/收起侧边栏菜单「日志管理」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backend/microservice">微服务架构</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/php">php</a><button aria-label="打开/收起侧边栏菜单「php」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/rabbitmq">RabbitMQ</a><button aria-label="打开/收起侧边栏菜单「RabbitMQ」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backend/server">服务器 学习</a><button aria-label="打开/收起侧边栏菜单「服务器 学习」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/base">基础知识</a><button aria-label="打开/收起侧边栏菜单「基础知识」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/big-data">大数据</a><button aria-label="打开/收起侧边栏菜单「大数据」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/blockchain">区块链</a><button aria-label="打开/收起侧边栏菜单「区块链」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/book">开源书籍</a><button aria-label="打开/收起侧边栏菜单「开源书籍」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/cross-platform">跨平台</a><button aria-label="打开/收起侧边栏菜单「跨平台」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/embedded">嵌入式</a><button aria-label="打开/收起侧边栏菜单「嵌入式」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/front">前端</a><button aria-label="打开/收起侧边栏菜单「前端」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/game">游戏开发</a><button aria-label="打开/收起侧边栏菜单「游戏开发」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/hardware">硬件开发</a><button aria-label="打开/收起侧边栏菜单「硬件开发」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/internet">网络</a><button aria-label="打开/收起侧边栏菜单「网络」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/lawyer">法律学习</a><button aria-label="打开/收起侧边栏菜单「法律学习」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/mobile">移动开发</a><button aria-label="打开/收起侧边栏菜单「移动开发」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/ops">运维</a><button aria-label="打开/收起侧边栏菜单「运维」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/os">操作系统</a><button aria-label="打开/收起侧边栏菜单「操作系统」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/other_platform">第三方平台</a><button aria-label="打开/收起侧边栏菜单「第三方平台」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/plan">计划</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/product-ops">产品运营</a><button aria-label="打开/收起侧边栏菜单「产品运营」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/sec">安全</a><button aria-label="打开/收起侧边栏菜单「安全」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/system-structure">系统架构</a><button aria-label="打开/收起侧边栏菜单「系统架构」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/test">测试</a><button aria-label="打开/收起侧边栏菜单「测试」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tools">开发工具</a><button aria-label="打开/收起侧边栏菜单「开发工具」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/updates">更新记录</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/backend"><span itemprop="name">后端学习</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/backend/go"><span itemprop="name">Go</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/backend/go/interview"><span itemprop="name">面试</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">面试 拓展</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>面试 拓展</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="讲讲-go-的-select-底层数据结构和一些特性">讲讲 Go 的 select 底层数据结构和一些特性<a href="#讲讲-go-的-select-底层数据结构和一些特性" class="hash-link" aria-label="讲讲 Go 的 select 底层数据结构和一些特性的直接链接" title="讲讲 Go 的 select 底层数据结构和一些特性的直接链接">​</a></h2><p>go 的 select 为 golang 提供了多路 IO 复用机制，和其他 IO 复用一样，用于检测是否有读写事件是否 ready。linux 的系统 IO 模型有 select，poll，epoll，go 的 select 和 linux 系统 select 非常相似。</p><p>select 结构组成主要是由 case 语句和执行的函数组成 select 实现的多路复用是：每个线程或者进程都先到注册和接受的 channel（装置）注册，然后阻塞，然后只有一个线程在运输，当注册的线程和进程准备好数据后，装置会根据注册的信息得到相应的数据。</p><p><strong>select 的特性</strong></p><p>1）select 操作至少要有一个 case 语句，出现读写 nil 的 channel 该分支会忽略，在 nil 的 channel 上操作则会报错。</p><p>2）select 仅支持管道，而且是单协程操作。</p><p>3）每个 case 语句仅能处理一个管道，要么读要么写。</p><p>4）多个 case 语句的执行顺序是随机的。</p><p>5）存在 default 语句，select 将不会阻塞，但是存在 default 会影响性能。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="讲讲-go-的-slice-底层数据结构和一些特性">讲讲 Go 的 slice 底层数据结构和一些特性<a href="#讲讲-go-的-slice-底层数据结构和一些特性" class="hash-link" aria-label="讲讲 Go 的 slice 底层数据结构和一些特性的直接链接" title="讲讲 Go 的 slice 底层数据结构和一些特性的直接链接">​</a></h2><p>Go 的 slice 底层数据结构是由一个 array 指针指向底层数组，len 表示切片长度，cap 表示切片容量。slice 的主要实现是扩容。对于 append 向 slice 添加元素时，假如 slice 容量够用，则追加新元素进去，slice.len++，返回原来的 slice。当原容量不够，则 slice 先扩容，扩容之后 slice 得到新的 slice，将元素追加进新的 slice，slice.len++，返回新的 slice。对于切片的扩容规则：当切片比较小时（容量小于 1024），则采用较大的扩容倍速进行扩容（新的扩容会是原来的 2 倍），避免频繁扩容，从而减少内存分配的次数和数据拷贝的代价。当切片较大的时（原来的 slice 的容量大于或者等于 1024），采用较小的扩容倍速（新的扩容将扩大大于或者等于原来 1.25 倍），主要避免空间浪费，网上其实很多总结的是 1.25 倍，那是在不考虑内存对齐的情况下，实际上还要考虑内存对齐，扩容是大于或者等于 1.25 倍。</p><p>（关于刚才问的 slice 为什么传到函数内可能被修改，如果 slice 在函数内没有出现扩容，函数外和函数内 slice 变量指向是同一个数组，则函数内复制的 slice 变量值出现更改，函数外这个 slice 变量值也会被修改。如果 slice 在函数内出现扩容，则函数内变量的值会新生成一个数组（也就是新的 slice，而函数外的 slice 指向的还是原来的 slice，则函数内的修改不会影响函数外的 slice。）</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="调用函数传入结构体时应该传值还是指针">调用函数传入结构体时，应该传值还是指针？<a href="#调用函数传入结构体时应该传值还是指针" class="hash-link" aria-label="调用函数传入结构体时，应该传值还是指针？的直接链接" title="调用函数传入结构体时，应该传值还是指针？的直接链接">​</a></h2><p>Go 的函数参数传递都是值传递。所谓值传递：指在调用函数时将实际参数复制一份传递到函数中，这样在函数中如果对参数进行修改，将不会影响到实际参数。参数传递还有引用传递，所谓引用传递是指在调用函数时将实际参数的地址传递到函数中，那么在函数中对参数所进行的修改，将影响到实际参数</p><p>因为 Go 里面的 map，slice，chan 是引用类型。变量区分值类型和引用类型。所谓值类型：变量和变量的值存在同一个位置。所谓引用类型：变量和变量的值是不同的位置，变量的值存储的是对值的引用。但并不是 map，slice，chan 的所有的变量在函数内都能被修改，不同数据类型的底层存储结构和实现可能不太一样，情况也就不一样。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="golang-中解析-tag-是怎么实现的反射原理是什么">golang 中解析 tag 是怎么实现的？反射原理是什么？<a href="#golang-中解析-tag-是怎么实现的反射原理是什么" class="hash-link" aria-label="golang 中解析 tag 是怎么实现的？反射原理是什么？的直接链接" title="golang 中解析 tag 是怎么实现的？反射原理是什么？的直接链接">​</a></h2><p>Go 中解析的 tag 是通过反射实现的，反射是指计算机程序在运行时（Run time）可以访问、检测和修改它本身状态或行为的一种能力或动态知道给定数据对象的类型和结构，并有机会修改它。反射将接口变量转换成反射对象 Type 和 Value；反射可以通过反射对象 Value 还原成原先的接口变量；反射可以用来修改一个变量的值，前提是这个值可以被修改；tag是啥:结构体支持标记，name string <code>json:name-field</code> 就是 <code>json:name-field</code> 这部分</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rune-类型">rune 类型<a href="#rune-类型" class="hash-link" aria-label="rune 类型的直接链接" title="rune 类型的直接链接">​</a></h2><p>相当int32</p><p>golang中的字符串底层实现是通过byte数组的，中文字符在unicode下占2个字节，在utf-8编码下占3个字节，而golang默认编码正好是utf-8</p><p>byte 等同于int8，常用来处理ascii字符</p><p>rune 等同于int32,常用来处理unicode或utf-8字符</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="uint-类型溢出问题">uint 类型溢出问题<a href="#uint-类型溢出问题" class="hash-link" aria-label="uint 类型溢出问题的直接链接" title="uint 类型溢出问题的直接链接">​</a></h2><p>超过最大存储值如uint8最大是255</p><p>var a uint8 =255</p><p>var b uint8 =1</p><p>a+b = 0总之类型溢出会出现难以意料的事</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数组和切片的区别">数组和切片的区别<a href="#数组和切片的区别" class="hash-link" aria-label="数组和切片的区别的直接链接" title="数组和切片的区别的直接链接">​</a></h2><p><strong>相同点</strong> :</p><ol><li>只能存储一组相同类型的数据结构</li><li>都是通过下标来访问,并且有容量长度,长度通过len获取,容量通过cap获取</li></ol><p><strong>区别</strong> :</p><ol><li>数组是定长,访问和复制不能超过数组定义的长度,否则就会下标越界,切片长度和容量可以自动扩容</li><li>数组是值类型,切片是引用类型,每个切片都引用了一个底层数组,切片本身不能存储任何数据,都是这底层数组存储数据,所以修改切片的时候修改的是底层数组中的数据.切片一旦扩容,指向一个新的底层数组,内存地址也就随之改变</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="for-range-的时候它的地址会发生变化么">for range 的时候它的地址会发生变化么<a href="#for-range-的时候它的地址会发生变化么" class="hash-link" aria-label="for range 的时候它的地址会发生变化么的直接链接" title="for range 的时候它的地址会发生变化么的直接链接">​</a></h2><p>在 for a,b := range c 遍历中， a 和 b 在内存中只会存在一份，即之后每次循环时遍历到的数据都是以值覆盖的方式赋给 a 和 b，a，b 的内存地址始终不变。由于有这个特性，for 循环里面如果开协程，不要直接把 a 或者 b 的地址传给协程。解决办法：在每次循环时，创建一个临时变量。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="go-defer多个-defer-的顺序defer-在什么时机会修改返回值">go defer，多个 defer 的顺序，defer 在什么时机会修改返回值<a href="#go-defer多个-defer-的顺序defer-在什么时机会修改返回值" class="hash-link" aria-label="go defer，多个 defer 的顺序，defer 在什么时机会修改返回值的直接链接" title="go defer，多个 defer 的顺序，defer 在什么时机会修改返回值的直接链接">​</a></h2><p>作用：defer延迟函数，释放资源，收尾工作；如释放锁，关闭文件，关闭链接；捕获panic;</p><p>避坑指南：defer函数紧跟在资源打开后面，否则defer可能得不到执行，导致内存泄露。</p><p>多个 defer 调用顺序是 LIFO（后入先出），defer后的操作可以理解为压入栈中</p><p>defer，return，return value（函数返回值） 执行顺序：首先return，其次return value，最后defer。defer可以修改函数最终返回值，修改时机：有名返回值或者函数返回指针</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="讲讲-go-的-defer-底层数据结构和一些特性">讲讲 Go 的 defer 底层数据结构和一些特性<a href="#讲讲-go-的-defer-底层数据结构和一些特性" class="hash-link" aria-label="讲讲 Go 的 defer 底层数据结构和一些特性的直接链接" title="讲讲 Go 的 defer 底层数据结构和一些特性的直接链接">​</a></h2><p>每个 defer 语句都对应一个_defer 实例，多个实例使用指针连接起来形成一个单连表，保存在 gotoutine 数据结构中，每次插入_defer 实例，均插入到链表的头部，函数结束再一次从头部取出，从而形成后进先出的效果。</p><p><strong>defer 的规则总结：</strong></p><p>延迟函数的参数是 defer 语句出现的时候就已经确定了的。</p><p>延迟函数执行按照后进先出的顺序执行，即先出现的 defer 最后执行。</p><p>延迟函数可能操作主函数的返回值。</p><p>申请资源后立即使用 defer 关闭资源是个好习惯。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="单引号双引号反引号的区别">单引号，双引号，反引号的区别<a href="#单引号双引号反引号的区别" class="hash-link" aria-label="单引号，双引号，反引号的区别的直接链接" title="单引号，双引号，反引号的区别的直接链接">​</a></h2><p>单引号，表示byte类型或rune类型，对应 uint8和int32类型，默认是 rune 类型。byte用来强调数据是raw data，而不是数字；而rune用来表示Unicode的code point。</p><p>双引号，才是字符串，实际上是字符数组。可以用索引号访问某字节，也可以用len()函数来获取字符串所占的字节长度。</p><p>反引号，表示字符串字面量，但不支持任何转义序列。字面量 raw literal string 的意思是，你定义时写的啥样，它就啥样，你有换行，它就换行。你写转义字符，它也就展示转义字符。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="map-相关">map 相关<a href="#map-相关" class="hash-link" aria-label="map 相关的直接链接" title="map 相关的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="map-使用注意的点是否并发安全">map 使用注意的点，是否并发安全？<a href="#map-使用注意的点是否并发安全" class="hash-link" aria-label="map 使用注意的点，是否并发安全？的直接链接" title="map 使用注意的点，是否并发安全？的直接链接">​</a></h3><p>map的类型是map<!-- -->[key]<!-- -->，key类型的ke必须是可比较的，通常情况，会选择内建的基本类型，比如整数、字符串做key的类型。如果要使用struct作为key，要保证struct对象在逻辑上是不可变的。在Go语言中，map<!-- -->[key]<!-- -->函数返回结果可以是一个值，也可以是两个值。map是无序的，如果我们想要保证遍历map时元素有序，可以使用辅助的数据结构，例如orderedmap。</p><p>第一，一定要先初始化，否则panic</p><p>第二，map类型是容易发生并发访问问题的。不注意就容易发生程序运行时并发读写导致的panic。 Go语言内建的map对象不是线程安全的，并发读写的时候运行时会有检查，遇到并发问题就会导致panic。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="map-循环是有序的还是无序的">map 循环是有序的还是无序的？<a href="#map-循环是有序的还是无序的" class="hash-link" aria-label="map 循环是有序的还是无序的？的直接链接" title="map 循环是有序的还是无序的？的直接链接">​</a></h3><p>无序的, map 因扩张⽽重新哈希时，各键值项存储位置都可能会发生改变，顺序自然也没法保证了，所以官方避免大家依赖顺序，直接打乱处理。就是 for range map 在开始处理循环逻辑的时候，就做了随机播种</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="map-中删除一个-key它的内存会释放么">map 中删除一个 key，它的内存会释放么<a href="#map-中删除一个-key它的内存会释放么" class="hash-link" aria-label="map 中删除一个 key，它的内存会释放么的直接链接" title="map 中删除一个 key，它的内存会释放么的直接链接">​</a></h3><p>如果删除的元素是值类型，如int，float，bool，string以及数组和struct，map的内存不会自动释放</p><p>如果删除的元素是引用类型，如指针，slice，map，chan等，map的内存会自动释放，但释放的内存是子元素应用类型的内存占用</p><p>将map设置为nil后，内存被回收。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="怎么处理对-map-进行并发访问有没有其他方案-区别是什么">怎么处理对 map 进行并发访问？有没有其他方案？ 区别是什么<a href="#怎么处理对-map-进行并发访问有没有其他方案-区别是什么" class="hash-link" aria-label="怎么处理对 map 进行并发访问？有没有其他方案？ 区别是什么的直接链接" title="怎么处理对 map 进行并发访问？有没有其他方案？ 区别是什么的直接链接">​</a></h3><ol><li>方式一、使用内置sync.Map，详细参考</li><li>方式二、使用读写锁实现并发安全map</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nil-map-和空-map-有何不同">nil map 和空 map 有何不同？<a href="#nil-map-和空-map-有何不同" class="hash-link" aria-label="nil map 和空 map 有何不同？的直接链接" title="nil map 和空 map 有何不同？的直接链接">​</a></h3><p>1）可以对未初始化的map进行取值，但取出来的东西是空：</p><p>var m1 map<!-- -->[string]<!-- -->string</p><p>fmt.Println(m1<!-- -->[&quot;1&quot;]<!-- -->)</p><p>2）不能对未初始化的map进行赋值，这样将会抛出一个异常：</p><p>var m1 map<!-- -->[string]<!-- -->string</p><p>m1<!-- -->[&quot;1&quot;]<!-- --> = &quot;1&quot;</p><p>panic: assignment to entry in nil map</p><p>3) 通过fmt打印map时，空map和nil map结果是一样的，都为map[]。所以，这个时候别断定map是空还是nil，而应该通过map == nil来判断。</p><p><strong>nil map 未初始化，空map是长度为空</strong></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="map-的数据结构是什么是怎么实现扩容">map 的数据结构是什么？是怎么实现扩容<a href="#map-的数据结构是什么是怎么实现扩容" class="hash-link" aria-label="map 的数据结构是什么？是怎么实现扩容的直接链接" title="map 的数据结构是什么？是怎么实现扩容的直接链接">​</a></h3><p>golang 中 map 是一个 kv 对集合。底层使用 hash table，用链表来解决冲突 ，出现冲突时，不是每一个 key 都申请一个结构通过链表串起来，而是以 bmap 为最小粒度挂载，一个 bmap 可以放 8 个 kv。在哈希函数的选择上，会在程序启动时，检测 cpu 是否支持 aes，如果支持，则使用 aes hash，否则使用 memhash。每个 map 的底层结构是 hmap，是有若干个结构为 bmap 的 bucket 组成的数组。每个 bucket 底层都采用链表结构。</p><p><strong>hmap 的结构如下：</strong></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> hmap </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count     </span><span class="token builtin">int</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">// 元素个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    flags     </span><span class="token builtin">uint8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    B         </span><span class="token builtin">uint8</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 扩容常量相关字段B是buckets数组的长度的对数 2^B</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    noverflow </span><span class="token builtin">uint16</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic">// 溢出的bucket个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hash0     </span><span class="token builtin">uint32</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic">// hash seed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buckets    unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Pointer      </span><span class="token comment" style="color:#999988;font-style:italic">// buckets 数组指针</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    oldbuckets unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Pointer      </span><span class="token comment" style="color:#999988;font-style:italic">// 结构扩容的时候用于赋值的buckets数组</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nevacuate  </span><span class="token builtin">uintptr</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// 搬迁进度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    extra </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">mapextra                </span><span class="token comment" style="color:#999988;font-style:italic">// 用于扩容的指针</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>map 的容量大小</strong></p><p>底层调用 makemap 函数，计算得到合适的 B，map 容量最多可容纳 6.52^B 个元素，6.5 为装载因子阈值常量。装载因子的计算公式是：装载因子=填入表中的元素个数/散列表的长度，装载因子越大，说明空闲位置越少，冲突越多，散列表的性能会下降。底层调用 makemap 函数，计算得到合适的 B，map 容量最多可容纳 6.52^B 个元素，6.5 为装载因子阈值常量。装载因子的计算公式是：装载因子=填入表中的元素个数/散列表的长度，装载因子越大，说明空闲位置越少，冲突越多，散列表的性能会下降。</p><p><strong>触发 map 扩容的条件</strong></p><p>1）装载因子超过阈值，源码里定义的阈值是 6.5。</p><p>2）overflow 的 bucket 数量过多 map 的 bucket 定位和 key 的定位高八位用于定位 bucket，低八位用于定位 key，快速试错后再进行完整对比</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="slices能作为map类型的key吗">slices能作为map类型的key吗？<a href="#slices能作为map类型的key吗" class="hash-link" aria-label="slices能作为map类型的key吗？的直接链接" title="slices能作为map类型的key吗？的直接链接">​</a></h3><p>当时被问的一脸懵逼，其实是这个问题的变种：golang 哪些类型可以作为map key？</p><p>在golang规范中，可比较的类型都可以作为map key；这个问题又延伸到在：golang规范中，哪些数据类型可以比较？</p><p><strong>不能作为map key 的类型包括：</strong></p><ul><li>slices</li><li>functions</li><li>maps</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="context相关">context相关<a href="#context相关" class="hash-link" aria-label="context相关的直接链接" title="context相关的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="context-结构是什么样的context-使用场景和用途-参考">context 结构是什么样的？context 使用场景和用途？ <a href="https://www.cnblogs.com/juanmaofeifei/p/14439957.html" target="_blank" rel="noopener noreferrer">参考</a><a href="#context-结构是什么样的context-使用场景和用途-参考" class="hash-link" aria-label="context-结构是什么样的context-使用场景和用途-参考的直接链接" title="context-结构是什么样的context-使用场景和用途-参考的直接链接">​</a></h3><p>Go 的 Context 的数据结构包含 Deadline，Done，Err，Value，Deadline 方法返回一个 time.Time，表示当前 Context 应该结束的时间，ok 则表示有结束时间，Done 方法当 Context 被取消或者超时时候返回的一个 close 的 channel，告诉给 context 相关的函数要停止当前工作然后返回了，Err 表示 context 被取消的原因，Value 方法表示 context 实现共享数据存储的地方，是协程安全的。context 在业务中是经常被使用的，</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其主要的应用">其主要的应用<a href="#其主要的应用" class="hash-link" aria-label="其主要的应用的直接链接" title="其主要的应用的直接链接">​</a></h3><ol><li>上下文控制，</li><li>多个 goroutine 之间的数据交互等</li><li>超时控制：到某个时间点超时，过多久超时。</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="channel相关">channel相关<a href="#channel相关" class="hash-link" aria-label="channel相关的直接链接" title="channel相关的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="channel-是否线程安全锁用在什么地方">channel 是否线程安全？锁用在什么地方？<a href="#channel-是否线程安全锁用在什么地方" class="hash-link" aria-label="channel 是否线程安全？锁用在什么地方？的直接链接" title="channel 是否线程安全？锁用在什么地方？的直接链接">​</a></h3><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="go-channel-的底层实现原理">go channel 的底层实现原理<a href="#go-channel-的底层实现原理" class="hash-link" aria-label="go channel 的底层实现原理的直接链接" title="go channel 的底层实现原理的直接链接">​</a></h3><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nil关闭的-channel有数据的-channel再进行读写关闭会怎么样各类变种题型重要">nil、关闭的 channel、有数据的 channel，再进行读、写、关闭会怎么样？（各类变种题型，重要）<a href="#nil关闭的-channel有数据的-channel再进行读写关闭会怎么样各类变种题型重要" class="hash-link" aria-label="nil、关闭的 channel、有数据的 channel，再进行读、写、关闭会怎么样？（各类变种题型，重要）的直接链接" title="nil、关闭的 channel、有数据的 channel，再进行读、写、关闭会怎么样？（各类变种题型，重要）的直接链接">​</a></h3><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="向-channel-发送数据和从-channel-读数据的流程是什么样的">向 channel 发送数据和从 channel 读数据的流程是什么样的<a href="#向-channel-发送数据和从-channel-读数据的流程是什么样的" class="hash-link" aria-label="向 channel 发送数据和从 channel 读数据的流程是什么样的的直接链接" title="向 channel 发送数据和从 channel 读数据的流程是什么样的的直接链接">​</a></h3><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="讲讲-go-的-chan-底层数据结构和主要使用场景">讲讲 Go 的 chan 底层数据结构和主要使用场景<a href="#讲讲-go-的-chan-底层数据结构和主要使用场景" class="hash-link" aria-label="讲讲 Go 的 chan 底层数据结构和主要使用场景的直接链接" title="讲讲 Go 的 chan 底层数据结构和主要使用场景的直接链接">​</a></h3><p>channel 的数据结构包含 qccount 当前队列中剩余元素个数，dataqsiz 环形队列长度，即可以存放的元素个数，buf 环形队列指针，elemsize 每个元素的大小，closed 标识关闭状态，elemtype 元素类型，sendx 队列下表，指示元素写入时存放到队列中的位置，recv 队列下表，指示元素从队列的该位置读出。recvq 等待读消息的 goroutine 队列，sendq 等待写消息的 goroutine 队列，lock 互斥锁，chan 不允许并发读写。</p><p>无缓冲和有缓冲区别： 管道没有缓冲区，从管道读数据会阻塞，直到有协程向管道中写入数据。同样，向管道写入数据也会阻塞，直到有协程从管道读取数据。管道有缓冲区但缓冲区没有数据，从管道读取数据也会阻塞，直到协程写入数据，如果管道满了，写数据也会阻塞，直到协程从缓冲区读取数据。</p><p>channel 的一些特点 1）、读写值 nil 管道会永久阻塞 2）、关闭的管道读数据仍然可以读数据 3）、往关闭的管道写数据会 panic 4）、关闭为 nil 的管道 panic 5）、关闭已经关闭的管道 panic</p><p>向 channel 写数据的流程： 如果等待接收队列 recvq 不为空，说明缓冲区中没有数据或者没有缓冲区，此时直接从 recvq 取出 G,并把数据写入，最后把该 G 唤醒，结束发送过程； 如果缓冲区中有空余位置，将数据写入缓冲区，结束发送过程； 如果缓冲区中没有空余位置，将待发送数据写入 G，将当前 G 加入 sendq，进入睡眠，等待被读 goroutine 唤醒；</p><p>向 channel 读数据的流程： 如果等待发送队列 sendq 不为空，且没有缓冲区，直接从 sendq 中取出 G，把 G 中数据读出，最后把 G 唤醒，结束读取过程； 如果等待发送队列 sendq 不为空，此时说明缓冲区已满，从缓冲区中首部读出数据，把 G 中数据写入缓冲区尾部，把 G 唤醒，结束读取过程； 如果缓冲区中有数据，则从缓冲区取出数据，结束读取过程；将当前 goroutine 加入 recvq，进入睡眠，等待被写 goroutine 唤醒；</p><p>使用场景： 消息传递、消息过滤，信号广播，事件订阅与广播，请求、响应转发，任务分发，结果汇总，并发控制，限流，同步与异步</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="gmp相关">GMP相关<a href="#gmp相关" class="hash-link" aria-label="GMP相关的直接链接" title="GMP相关的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是-gmp">什么是 GMP<a href="#什么是-gmp" class="hash-link" aria-label="什么是 GMP的直接链接" title="什么是 GMP的直接链接">​</a></h3><p>G 代表着 goroutine，P 代表着上下文处理器，M 代表 thread 线程，在 GPM 模型，有一个全局队列（Global Queue）：存放等待运行的 G，还有一个 P 的本地队列：也是存放等待运行的 G，但数量有限，不超过 256 个。GPM 的调度流程从 go func()开始创建一个 goroutine，新建的 goroutine 优先保存在 P 的本地队列中，如果 P 的本地队列已经满了，则会保存到全局队列中。M 会从 P 的队列中取一个可执行状态的 G 来执行，如果 P 的本地队列为空，就会从其他的 MP 组合偷取一个可执行的 G 来执行，当 M 执行某一个 G 时候发生系统调用或者阻塞，M 阻塞，如果这个时候 G 在执行，runtime 会把这个线程 M 从 P 中摘除，然后创建一个新的操作系统线程来服务于这个 P，当 M 系统调用结束时，这个 G 会尝试获取一个空闲的 P 来执行，并放入到这个 P 的本地队列，如果这个线程 M 变成休眠状态，加入到空闲线程中，然后整个 G 就会被放入到全局队列中。</p><p>关于 G,P,M 的个数问题，G 的个数理论上是无限制的，但是受内存限制，P 的数量一般建议是逻辑 CPU 数量的 2 倍，M 的数据默认启动的时候是 10000，内核很难支持这么多线程数，所以整个限制客户忽略，M 一般不做设置，设置好 P，M 一般都是要大于 P。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="进程线程协程有什么区别">进程、线程、协程有什么区别<a href="#进程线程协程有什么区别" class="hash-link" aria-label="进程、线程、协程有什么区别的直接链接" title="进程、线程、协程有什么区别的直接链接">​</a></h3><p>进程：是应用程序的启动实例，每个进程都有独立的内存空间，不同的进程通过进程间的通信方式来通信。</p><p>线程：从属于进程，每个进程至少包含一个线程，线程是 CPU 调度的基本单位，多个线程之间可以共享进程的资源并通过共享内存等线程间的通信方式来通信。</p><p>协程：为轻量级线程，与线程相比，协程不受操作系统的调度，协程的调度器由用户应用程序提供，协程调度器按照调度策略把协程调度到线程中运行</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="抢占式调度是如何抢占的">抢占式调度是如何抢占的<a href="#抢占式调度是如何抢占的" class="hash-link" aria-label="抢占式调度是如何抢占的的直接链接" title="抢占式调度是如何抢占的的直接链接">​</a></h3><p><strong>基于协作式抢占</strong></p><p><strong>基于信号量抢占</strong></p><p>就像操作系统要负责线程的调度一样，Go的runtime要负责goroutine的调度。现代操作系统调度线程都是抢占式的，我们不能依赖用户代码主动让出CPU，或者因为IO、锁等待而让出，这样会造成调度的不公平。基于经典的时间片算法，当线程的时间片用完之后，会被时钟中断给打断，调度器会将当前线程的执行上下文进行保存，然后恢复下一个线程的上下文，分配新的时间片令其开始执行。这种抢占对于线程本身是无感知的，系统底层支持，不需要开发人员特殊处理。</p><p>基于时间片的抢占式调度有个明显的优点，能够避免CPU资源持续被少数线程占用，从而使其他线程长时间处于饥饿状态。goroutine的调度器也用到了时间片算法，但是和操作系统的线程调度还是有些区别的，因为整个Go程序都是运行在用户态的，所以不能像操作系统那样利用时钟中断来打断运行中的goroutine。也得益于完全在用户态实现，goroutine的调度切换更加轻量。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="m-和-p-的数量问题">M 和 P 的数量问题<a href="#m-和-p-的数量问题" class="hash-link" aria-label="M 和 P 的数量问题的直接链接" title="M 和 P 的数量问题的直接链接">​</a></h3><p>p默认cpu内核数</p><p>M与P的数量没有绝对关系，一个M阻塞，P就会去创建或者切换另一个M，所以，即使P的默认数量是1，也有可能会创建很多个M出来</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="锁相关">锁相关<a href="#锁相关" class="hash-link" aria-label="锁相关的直接链接" title="锁相关的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="除了-mutex-以外还有那些方式安全读写共享变量">除了 mutex 以外还有那些方式安全读写共享变量<a href="#除了-mutex-以外还有那些方式安全读写共享变量" class="hash-link" aria-label="除了 mutex 以外还有那些方式安全读写共享变量的直接链接" title="除了 mutex 以外还有那些方式安全读写共享变量的直接链接">​</a></h3><ul><li>将共享变量的读写放到一个 goroutine 中，其它 goroutine 通过 channel 进行读写操作。</li><li>可以用个数为 1 的信号量（semaphore）实现互斥</li><li>通过 Mutex 锁实现</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="go-如何实现原子操作">Go 如何实现原子操作<a href="#go-如何实现原子操作" class="hash-link" aria-label="Go 如何实现原子操作的直接链接" title="Go 如何实现原子操作的直接链接">​</a></h3><p>原子操作就是不可中断的操作，外界是看不到原子操作的中间状态，要么看到原子操作已经完成，要么看到原子操作已经结束。在某个值的原子操作执行的过程中，CPU 绝对不会再去执行其他针对该值的操作，那么其他操作也是原子操作。</p><p>Go 语言的标准库代码包 sync/atomic 提供了原子的读取（Load 为前缀的函数）或写入（Store 为前缀的函数）某个值（这里细节还要多去查查资料）。</p><p><strong>原子操作与互斥锁的区别</strong></p><p>1）、互斥锁是一种数据结构，用来让一个线程执行程序的关键部分，完成互斥的多个操作。</p><p>2）、原子操作是针对某个值的单个互斥操作。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mutex-是悲观锁还是乐观锁悲观锁乐观锁是什么">Mutex 是悲观锁还是乐观锁？悲观锁、乐观锁是什么？<a href="#mutex-是悲观锁还是乐观锁悲观锁乐观锁是什么" class="hash-link" aria-label="Mutex 是悲观锁还是乐观锁？悲观锁、乐观锁是什么？的直接链接" title="Mutex 是悲观锁还是乐观锁？悲观锁、乐观锁是什么？的直接链接">​</a></h3><p>悲观锁</p><p>悲观锁：当要对数据库中的一条数据进行修改的时候，为了避免同时被其他人修改，最好的办法就是直接对该数据进行加锁以防止并发。这种借助数据库锁机制，在修改数据之前先锁定，再修改的方式被称之为悲观并发控制【Pessimistic Concurrency Control，缩写“PCC”，又名“悲观锁”】。</p><p>乐观锁是相对悲观锁而言的，乐观锁假设数据一般情况不会造成冲突，所以在数据进行提交更新的时候，才会正式对数据的冲突与否进行检测，如果冲突，则返回给用户异常信息，让用户决定如何去做。乐观锁适用于读多写少的场景，这样可以提高程序的吞吐量</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mutex-有几种模式">Mutex 有几种模式<a href="#mutex-有几种模式" class="hash-link" aria-label="Mutex 有几种模式的直接链接" title="Mutex 有几种模式的直接链接">​</a></h3><p><strong>1）正常模式</strong></p><ol><li>当前的mutex只有一个goruntine来获取，那么没有竞争，直接返回。</li><li>新的goruntine进来，如果当前mutex已经被获取了，则该goruntine进入一个先入先出的waiter队列，在mutex被释放后，waiter按照先进先出的方式获取锁。该goruntine会处于自旋状态(不挂起，继续占有cpu)</li><li>新的goruntine进来，mutex处于空闲状态，将参与竞争。新来的 goroutine 有先天的优势，它们正在 CPU 中运行，可能它们的数量还不少，所以，在高并发情况下，被唤醒的 waiter 可能比较悲剧地获取不到锁，这时，它会被插入到队列的前面。如果 waiter 获取不到锁的时间超过阈值 1 毫秒，那么，这个 Mutex 就进入到了饥饿模式。</li></ol><p><strong>2）饥饿模式</strong></p><p>在饥饿模式下，Mutex 的拥有者将直接把锁交给队列最前面的 waiter。新来的 goroutine 不会尝试获取锁，即使看起来锁没有被持有，它也不会去抢，也不会 spin（自旋），它会乖乖地加入到等待队列的尾部。 如果拥有 Mutex 的 waiter 发现下面两种情况的其中之一，它就会把这个 Mutex 转换成正常模式:</p><ol><li>此 waiter 已经是队列中的最后一个 waiter 了，没有其它的等待锁的 goroutine 了；</li><li>此 waiter 的等待时间小于 1 毫秒。</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="goroutine-的自旋占用资源如何解决">goroutine 的自旋占用资源如何解决<a href="#goroutine-的自旋占用资源如何解决" class="hash-link" aria-label="goroutine 的自旋占用资源如何解决的直接链接" title="goroutine 的自旋占用资源如何解决的直接链接">​</a></h3><p>自旋锁是指当一个线程在获取锁的时候，如果锁已经被其他线程获取，那么该线程将循环等待，然后不断地判断是否能够被成功获取，直到获取到锁才会退出循环。</p><p><strong>自旋的条件如下：</strong></p><ol><li>还没自旋超过 4 次,</li><li>多核处理器</li><li>GOMAXPROCS &gt; 1，</li><li>p 上本地 goroutine 队列为空。</li></ol><p>mutex 会让当前的 goroutine 去空转 CPU，在空转完后再次调用 CAS 方法去尝试性的占有锁资源，直到不满足自旋条件，则最终会加入到等待队列里。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="并发相关">并发相关<a href="#并发相关" class="hash-link" aria-label="并发相关的直接链接" title="并发相关的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1怎么控制并发数">1、怎么控制并发数？<a href="#1怎么控制并发数" class="hash-link" aria-label="1、怎么控制并发数？的直接链接" title="1、怎么控制并发数？的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第一有缓冲通道">第一，有缓冲通道<a href="#第一有缓冲通道" class="hash-link" aria-label="第一，有缓冲通道的直接链接" title="第一，有缓冲通道的直接链接">​</a></h4><p>根据通道中没有数据时读取操作陷入阻塞和通道已满时继续写入操作陷入阻塞的特性，正好实现控制并发数量。</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> count </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 最大支持并发</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 任务总数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> wg </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> sync</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WaitGroup</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//控制主协程等待所有子协程执行完之后再退出。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> c </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 控制任务并发的chan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">:=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">sum</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  wg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  c </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 作用类似于waitgroup.Add(1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">j </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> wg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Done</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> c </span><span class="token comment" style="color:#999988;font-style:italic">// 执行完毕，释放资源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> wg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第二三方库实现的协程池">第二，三方库实现的协程池<a href="#第二三方库实现的协程池" class="hash-link" aria-label="第二，三方库实现的协程池的直接链接" title="第二，三方库实现的协程池的直接链接">​</a></h4><p>panjf2000/ants（比较火）</p><p>Jeffail/tunny</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;log&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;github.com/Jeffail/tunny&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> pool </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> tunny</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> pool</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"> pool</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Second </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2多个-goroutine-对同一个-map-写会-panic异常是否可以用-defer-捕获">2、多个 goroutine 对同一个 map 写会 panic，异常是否可以用 defer 捕获？<a href="#2多个-goroutine-对同一个-map-写会-panic异常是否可以用-defer-捕获" class="hash-link" aria-label="2、多个 goroutine 对同一个 map 写会 panic，异常是否可以用 defer 捕获？的直接链接" title="2、多个 goroutine 对同一个 map 写会 panic，异常是否可以用 defer 捕获？的直接链接">​</a></h3><p>可以捕获异常，但是只能捕获一次，Go语言，可以使用多值返回来返回错误。不要用异常代替错误，更不要用来控制流程。在极个别的情况下，才使用Go中引入的Exception处理：defer, panic, recover Go中，对异常处理的原则是：多用error包，少用panic</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">recover</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 打印异常，关闭资源，退出此函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="gc相关">GC相关<a href="#gc相关" class="hash-link" aria-label="GC相关的直接链接" title="GC相关的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="go-gc-是怎么实现的">go gc 是怎么实现的？（<a href="#go-gc-是怎么实现的" class="hash-link" aria-label="go gc 是怎么实现的？（的直接链接" title="go gc 是怎么实现的？（的直接链接">​</a></h3><p>细分常见的三个问题：1、GC机制随着golang版本变化如何变化的？2、三色标记法的流程？3、插入屏障、删除屏障，混合写屏障（具体的实现比较难描述，但你要知道屏障的作用：避免程序运行过程中，变量被误回收；减少STW的时间）4、虾皮还问了个开放性的题目：你觉得以后GC机制会怎么优化？</p><p>Go 的 GC 回收有三次演进过程，Go V1.3 之前普通标记清除（mark and sweep）方法，整体过程需要启动 STW，效率极低。GoV1.5 三色标记法，堆空间启动写屏障，栈空间不启动，全部扫描之后，需要重新扫描一次栈(需要 STW)，效率普通。GoV1.8 三色标记法，混合写屏障机制：栈空间不启动（全部标记成黑色），堆空间启用写屏障，整个过程不要 STW，效率高。</p><p>Go1.3 之前的版本所谓标记清除是先启动 STW 暂停，然后执行标记，再执行数据回收，最后停止 STW。Go1.3 版本标记清除做了点优化，流程是：先启动 STW 暂停，然后执行标记，停止 STW，最后再执行数据回收。</p><p>Go1.5 三色标记主要是插入屏障和删除屏障，写入屏障的流程：程序开始，全部标记为白色，1）所有的对象放到白色集合，2）遍历一次根节点，得到灰色节点，3）遍历灰色节点，将可达的对象，从白色标记灰色，遍历之后的灰色标记成黑色，4）由于并发特性，此刻外界向在堆中的对象发生添加对象，以及在栈中的对象添加对象，在堆中的对象会触发插入屏障机制，栈中的对象不触发，5）由于堆中对象插入屏障，则会把堆中黑色对象添加的白色对象改成灰色，栈中的黑色对象添加的白色对象依然是白色，6）循环第 5 步，直到没有灰色节点，7）在准备回收白色前，重新遍历扫描一次栈空间，加上 STW 暂停保护栈，防止外界干扰（有新的白色会被添加成黑色）在 STW 中，将栈中的对象一次三色标记，直到没有灰色，8）停止 STW，清除白色。至于删除写屏障，则是遍历灰色节点的时候出现可达的节点被删除，这个时候触发删除写屏障，这个可达的被删除的节点也是灰色，等循环三色标记之后，直到没有灰色节点，然后清理白色，删除写屏障会造成一个对象即使被删除了最后一个指向它的指针也依旧可以活过这一轮，在下一轮 GC 中被清理掉。</p><p>GoV1.8 混合写屏障规则是：</p><ol><li>GC 开始将栈上的对象全部扫描并标记为黑色(之后不再进行第二次重复扫描，无需 STW)</li><li>GC 期间，任何在栈上创建的新对象，均为黑色。</li><li>被删除的对象标记为灰色。</li><li>被添加的对象标记为灰色。</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="go-是-gc-算法是怎么实现的">go 是 gc 算法是怎么实现的<a href="#go-是-gc-算法是怎么实现的" class="hash-link" aria-label="go 是 gc 算法是怎么实现的的直接链接" title="go 是 gc 算法是怎么实现的的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> n </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">amp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">work</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cycles</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">gcWaitOnMark</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">gcStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gcTrigger</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcTriggerCycle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">gcWaitOnMark</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">amp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">work</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cycles</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> n</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">amp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">amp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sweepone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token function" style="color:#d73a49">uintptr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sweep</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nbgsweep</span><span class="token operator" style="color:#393A34">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">Gosched</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">amp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">work</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cycles</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> n</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">amp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">amp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">amp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">mheap_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sweepers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">Gosched</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> mp </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">acquirem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> cycle </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">amp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">work</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cycles</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> cycle </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> n</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gcphase </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> _GCmark </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">amp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">amp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> cycle </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> n</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">mProf_PostSweep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">releasem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="gc-中-stw-时机各个阶段是如何解决的">GC 中 stw 时机，各个阶段是如何解决的<a href="#gc-中-stw-时机各个阶段是如何解决的" class="hash-link" aria-label="GC 中 stw 时机，各个阶段是如何解决的的直接链接" title="GC 中 stw 时机，各个阶段是如何解决的的直接链接">​</a></h3><ol><li>在开始新的一轮 GC 周期前，需要调用 gcWaitOnMark 方法上一轮 GC 的标记结束（含扫描终止、标记、或标记终止等）。</li><li>开始新的一轮 GC 周期，调用 gcStart 方法触发 GC 行为，开始扫描标记阶段。</li><li>需要调用 gcWaitOnMark 方法等待，直到当前 GC 周期的扫描、标记、标记终止完成。</li><li>需要调用 sweepone 方法，扫描未扫除的堆跨度，并持续扫除，保证清理完成。在等待扫除完毕前的阻塞时间，会调用 Gosched 让出</li><li>在本轮 GC 已经基本完成后，会调用 mProf_PostSweep 方法。以此记录最后一次标记终止时的堆配置文件快照。</li><li>结束，释放 M。</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="gc-的触发时机">GC 的触发时机<a href="#gc-的触发时机" class="hash-link" aria-label="GC 的触发时机的直接链接" title="GC 的触发时机的直接链接">​</a></h3><p>分为系统触发和主动触发</p><ol><li>gcTriggerHeap：当所分配的堆大小达到阈值（由控制器计算的触发堆的大小）时，将会触发。</li><li>gcTriggerTime：当距离上一个 GC 周期的时间超过一定时间时，将会触发。时间周期以runtime.forcegcperiod 变量为准，默认 2 分钟</li><li>gcTriggerCycle：如果没有开启 GC，则启动 GC</li><li>手动触发的 runtime.GC 方法</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="内存相关">内存相关<a href="#内存相关" class="hash-link" aria-label="内存相关的直接链接" title="内存相关的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="谈谈内存泄露什么情况下内存会泄露怎么定位排查内存泄漏问题">谈谈内存泄露，什么情况下内存会泄露？怎么定位排查内存泄漏问题<a href="#谈谈内存泄露什么情况下内存会泄露怎么定位排查内存泄漏问题" class="hash-link" aria-label="谈谈内存泄露，什么情况下内存会泄露？怎么定位排查内存泄漏问题的直接链接" title="谈谈内存泄露，什么情况下内存会泄露？怎么定位排查内存泄漏问题的直接链接">​</a></h3><p>go 中的内存泄漏一般都是 goroutine 泄漏，就是 goroutine 没有被关闭，或者没有添加超时控制，让 goroutine 一只处于阻塞状态，不能被 GC</p><p>内存泄露有下面一些情况</p><ol><li>如果 goroutine 在执行时被阻塞而无法退出，就会导致 goroutine 的内存泄漏，一个 goroutine 的最低栈大小为 2KB，在高并发的场景下，对内存的消耗也是非常恐怖的。</li><li>互斥锁未释放或者造成死锁会造成内存泄漏</li><li>time.Ticker 是每隔指定的时间就会向通道内写数据。作为循环触发器，必须调用 stop 方法才会停止，从而被 GC 掉，否则会一直占用内存空间</li><li>字符串的截取引发临时性的内存泄漏</li><li>切片截取引起子切片内存泄漏</li><li>函数数组传参引发内存泄漏【如果我们在函数传参的时候用到了数组传参，且这个数组够大（我们假设数组大小为 100 万，64 位机上消耗的内存约为 800w 字节，即 8MB 内存），或者该函数短时间内被调用 N 次，那么可想而知，会消耗大量内存，对性能产生极大的影响，如果短时间内分配大量内存，而又来不及 GC，那么就会产生临时性的内存泄漏，对于高并发场景相当可怕。】</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="排查方式">排查方式<a href="#排查方式" class="hash-link" aria-label="排查方式的直接链接" title="排查方式的直接链接">​</a></h3><p>一般通过 pprof 是 Go 的性能分析工具，在程序运行过程中，可以记录程序的运行信息，可以是 CPU 使用情况、内存使用情况、goroutine 运行情况等，当需要性能调优或者定位 Bug 时候，这些记录的信息是相当重要。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="知道-golang-的内存逃逸吗什么情况下会发生内存逃逸">知道 golang 的内存逃逸吗？什么情况下会发生内存逃逸<a href="#知道-golang-的内存逃逸吗什么情况下会发生内存逃逸" class="hash-link" aria-label="知道 golang 的内存逃逸吗？什么情况下会发生内存逃逸的直接链接" title="知道 golang 的内存逃逸吗？什么情况下会发生内存逃逸的直接链接">​</a></h3><ol><li>本该分配到栈上的变量，跑到了堆上，这就导致了内存逃逸。</li><li>栈是高地址到低地址，栈上的变量，函数结束后变量会跟着回收掉，不会有额外性能的开销。</li><li>变量从栈逃逸到堆上，如果要回收掉，需要进行 gc，那么 gc 一定会带来额外的性能开销。编程语言不断优化 gc 算法，主要目的都是为了减少 gc 带来的额外性能开销，变量一旦逃逸会导致性能开销变大。</li></ol><p>内存逃逸的情况如下：</p><ol><li>方法内返回局部变量指针</li><li>向 channel 发送指针数据</li><li>在闭包中引用包外的值</li><li>在 slice 或 map 中存储指针</li><li>切片（扩容后）长度太大</li><li>在 interface 类型上调用方法。</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="请简述-go-是如何分配内存的">请简述 Go 是如何分配内存的<a href="#请简述-go-是如何分配内存的" class="hash-link" aria-label="请简述 Go 是如何分配内存的的直接链接" title="请简述 Go 是如何分配内存的的直接链接">​</a></h3><p>mcache mcentral mheap mspan</p><p>Go 程序启动的时候申请一大块内存，并且划分 spans，bitmap，areana 区域；arena 区域按照页划分成一个个小块，span 管理一个或者多个页，mcentral 管理多个 span 供现场申请使用；mcache 作为线程私有资源，来源于 mcentral。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="channel-分配在栈上还是堆上哪些对象分配在堆上哪些对象分配在栈上">Channel 分配在栈上还是堆上？哪些对象分配在堆上，哪些对象分配在栈上<a href="#channel-分配在栈上还是堆上哪些对象分配在堆上哪些对象分配在栈上" class="hash-link" aria-label="Channel 分配在栈上还是堆上？哪些对象分配在堆上，哪些对象分配在栈上的直接链接" title="Channel 分配在栈上还是堆上？哪些对象分配在堆上，哪些对象分配在栈上的直接链接">​</a></h3><p>Channel 被设计用来实现协程间通信的组件，其作用域和生命周期不可能仅限于某个函数内部，所以 golang 直接将其分配在堆上</p><p>准确地说，你并不需要知道。Golang 中的变量只要被引用就一直会存活，存储在堆上还是栈上由内部实现决定而和具体的语法没有关系。</p><p>知道变量的存储位置确实和效率编程有关系。如果可能，Golang 编译器会将函数的局部变量分配到函数栈帧（stack frame）上。然而，如果编译器不能确保变量在函数 return 之后不再被引用，编译器就会将变量分配到堆上。而且，如果一个局部变量非常大，那么它也应该被分配到堆上而不是栈上。</p><p>当前情况下，如果一个变量被取地址，那么它就有可能被分配到堆上,然而，还要对这些变量做逃逸分析，如果函数 return 之后，变量不再被引用，则将其分配到栈上。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="介绍一下大对象小对象为什么小对象多了会造成-gc-压力">介绍一下大对象小对象，为什么小对象多了会造成 gc 压力<a href="#介绍一下大对象小对象为什么小对象多了会造成-gc-压力" class="hash-link" aria-label="介绍一下大对象小对象，为什么小对象多了会造成 gc 压力的直接链接" title="介绍一下大对象小对象，为什么小对象多了会造成 gc 压力的直接链接">​</a></h3><p>小于等于 32k 的对象就是小对象，其它都是大对象。一般小对象通过 mspan 分配内存；大对象则直接由 mheap 分配内存。通常小对象过多会导致 GC 三色法消耗过多的 CPU。优化思路是，减少对象分配。</p><p>小对象：如果申请小对象时，发现当前内存空间不存在空闲跨度时，将会需要调用 nextFree 方法获取新的可用的对象，可能会触发 GC 行为。</p><p>大对象：如果申请大于 32k 以上的大对象时，可能会触发 GC 行为。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="go-多返回值怎么实现的">Go 多返回值怎么实现的<a href="#go-多返回值怎么实现的" class="hash-link" aria-label="Go 多返回值怎么实现的的直接链接" title="Go 多返回值怎么实现的的直接链接">​</a></h2><p>Go 传参和返回值是通过 FP+offset 实现，并且存储在调用函数的栈帧中。FP 栈底寄存器，指向一个函数栈的顶部;PC 程序计数器，指向下一条执行指令;SB 指向静态数据的基指针，全局符号;SP 栈顶寄存器。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="讲讲-go-中主协程如何等待其余协程退出">讲讲 Go 中主协程如何等待其余协程退出<a href="#讲讲-go-中主协程如何等待其余协程退出" class="hash-link" aria-label="讲讲 Go 中主协程如何等待其余协程退出的直接链接" title="讲讲 Go 中主协程如何等待其余协程退出的直接链接">​</a></h2><p>Go 的 sync.WaitGroup 是等待一组协程结束，sync.WaitGroup 只有 3 个方法，Add()是添加计数，Done()减去一个计数，Wait()阻塞直到所有的任务完成。Go 里面还能通过有缓冲的 channel 实现其阻塞等待一组协程结束，这个不能保证一组 goroutine 按照顺序执行，可以并发执行协程。Go 里面能通过无缓冲的 channel 实现其阻塞等待一组协程结束，这个能保证一组 goroutine 按照顺序执行，但是不能并发执行。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="go-语言中不同的类型如何比较是否相等">Go 语言中不同的类型如何比较是否相等<a href="#go-语言中不同的类型如何比较是否相等" class="hash-link" aria-label="Go 语言中不同的类型如何比较是否相等的直接链接" title="Go 语言中不同的类型如何比较是否相等的直接链接">​</a></h2><p>像 string，int，float interface 等可以通过 reflect.DeepEqual 和等于号进行比较，像 slice，struct，map 则一般使用 reflect.DeepEqual 来检测是否相等。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="go-中-init-函数的特征">Go 中 init 函数的特征<a href="#go-中-init-函数的特征" class="hash-link" aria-label="Go 中 init 函数的特征的直接链接" title="Go 中 init 函数的特征的直接链接">​</a></h2><p>一个包下可以有多个 init 函数，每个文件也可以有多个 init 函数。多个 init 函数按照它们的文件名顺序逐个初始化。应用初始化时初始化工作的顺序是，从被导入的最深层包开始进行初始化，层层递出最后到 main 包。不管包被导入多少次，包内的 init 函数只会执行一次。应用初始化时初始化工作的顺序是，从被导入的最深层包开始进行初始化，层层递出最后到 main 包。但包级别变量的初始化先于包内 init 函数的执行。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="go-中-uintptr-和-unsafepointer-的区别">Go 中 uintptr 和 unsafe.Pointer 的区别<a href="#go-中-uintptr-和-unsafepointer-的区别" class="hash-link" aria-label="Go 中 uintptr 和 unsafe.Pointer 的区别的直接链接" title="Go 中 uintptr 和 unsafe.Pointer 的区别的直接链接">​</a></h2><p>unsafe.Pointer 是通用指针类型，它不能参与计算，任何类型的指针都可以转化成 unsafe.Pointer，unsafe.Pointer 可以转化成任何类型的指针，uintptr 可以转换为 unsafe.Pointer，unsafe.Pointer 可以转换为 uintptr。uintptr 是指针运算的工具，但是它不能持有指针对象（意思就是它跟指针对象不能互相转换），unsafe.Pointer 是指针对象进行运算（也就是 uintptr）的桥梁。</p></div><div>Loading Comments...</div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/backend/go/interview/base"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Go 面试基础</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/backend/go/note"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">每日笔记</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#讲讲-go-的-select-底层数据结构和一些特性" class="table-of-contents__link toc-highlight">讲讲 Go 的 select 底层数据结构和一些特性</a></li><li><a href="#讲讲-go-的-slice-底层数据结构和一些特性" class="table-of-contents__link toc-highlight">讲讲 Go 的 slice 底层数据结构和一些特性</a></li><li><a href="#调用函数传入结构体时应该传值还是指针" class="table-of-contents__link toc-highlight">调用函数传入结构体时，应该传值还是指针？</a></li><li><a href="#golang-中解析-tag-是怎么实现的反射原理是什么" class="table-of-contents__link toc-highlight">golang 中解析 tag 是怎么实现的？反射原理是什么？</a></li><li><a href="#rune-类型" class="table-of-contents__link toc-highlight">rune 类型</a></li><li><a href="#uint-类型溢出问题" class="table-of-contents__link toc-highlight">uint 类型溢出问题</a></li><li><a href="#数组和切片的区别" class="table-of-contents__link toc-highlight">数组和切片的区别</a></li><li><a href="#for-range-的时候它的地址会发生变化么" class="table-of-contents__link toc-highlight">for range 的时候它的地址会发生变化么</a></li><li><a href="#go-defer多个-defer-的顺序defer-在什么时机会修改返回值" class="table-of-contents__link toc-highlight">go defer，多个 defer 的顺序，defer 在什么时机会修改返回值</a></li><li><a href="#讲讲-go-的-defer-底层数据结构和一些特性" class="table-of-contents__link toc-highlight">讲讲 Go 的 defer 底层数据结构和一些特性</a></li><li><a href="#单引号双引号反引号的区别" class="table-of-contents__link toc-highlight">单引号，双引号，反引号的区别</a></li><li><a href="#map-相关" class="table-of-contents__link toc-highlight">map 相关</a><ul><li><a href="#map-使用注意的点是否并发安全" class="table-of-contents__link toc-highlight">map 使用注意的点，是否并发安全？</a></li><li><a href="#map-循环是有序的还是无序的" class="table-of-contents__link toc-highlight">map 循环是有序的还是无序的？</a></li><li><a href="#map-中删除一个-key它的内存会释放么" class="table-of-contents__link toc-highlight">map 中删除一个 key，它的内存会释放么</a></li><li><a href="#怎么处理对-map-进行并发访问有没有其他方案-区别是什么" class="table-of-contents__link toc-highlight">怎么处理对 map 进行并发访问？有没有其他方案？ 区别是什么</a></li><li><a href="#nil-map-和空-map-有何不同" class="table-of-contents__link toc-highlight">nil map 和空 map 有何不同？</a></li><li><a href="#map-的数据结构是什么是怎么实现扩容" class="table-of-contents__link toc-highlight">map 的数据结构是什么？是怎么实现扩容</a></li><li><a href="#slices能作为map类型的key吗" class="table-of-contents__link toc-highlight">slices能作为map类型的key吗？</a></li></ul></li><li><a href="#context相关" class="table-of-contents__link toc-highlight">context相关</a><ul><li><a href="#context-结构是什么样的context-使用场景和用途-参考" class="table-of-contents__link toc-highlight">context 结构是什么样的？context 使用场景和用途？ 参考</a></li><li><a href="#其主要的应用" class="table-of-contents__link toc-highlight">其主要的应用</a></li></ul></li><li><a href="#channel相关" class="table-of-contents__link toc-highlight">channel相关</a><ul><li><a href="#channel-是否线程安全锁用在什么地方" class="table-of-contents__link toc-highlight">channel 是否线程安全？锁用在什么地方？</a></li><li><a href="#go-channel-的底层实现原理" class="table-of-contents__link toc-highlight">go channel 的底层实现原理</a></li><li><a href="#nil关闭的-channel有数据的-channel再进行读写关闭会怎么样各类变种题型重要" class="table-of-contents__link toc-highlight">nil、关闭的 channel、有数据的 channel，再进行读、写、关闭会怎么样？（各类变种题型，重要）</a></li><li><a href="#向-channel-发送数据和从-channel-读数据的流程是什么样的" class="table-of-contents__link toc-highlight">向 channel 发送数据和从 channel 读数据的流程是什么样的</a></li><li><a href="#讲讲-go-的-chan-底层数据结构和主要使用场景" class="table-of-contents__link toc-highlight">讲讲 Go 的 chan 底层数据结构和主要使用场景</a></li></ul></li><li><a href="#gmp相关" class="table-of-contents__link toc-highlight">GMP相关</a><ul><li><a href="#什么是-gmp" class="table-of-contents__link toc-highlight">什么是 GMP</a></li><li><a href="#进程线程协程有什么区别" class="table-of-contents__link toc-highlight">进程、线程、协程有什么区别</a></li><li><a href="#抢占式调度是如何抢占的" class="table-of-contents__link toc-highlight">抢占式调度是如何抢占的</a></li><li><a href="#m-和-p-的数量问题" class="table-of-contents__link toc-highlight">M 和 P 的数量问题</a></li></ul></li><li><a href="#锁相关" class="table-of-contents__link toc-highlight">锁相关</a><ul><li><a href="#除了-mutex-以外还有那些方式安全读写共享变量" class="table-of-contents__link toc-highlight">除了 mutex 以外还有那些方式安全读写共享变量</a></li><li><a href="#go-如何实现原子操作" class="table-of-contents__link toc-highlight">Go 如何实现原子操作</a></li><li><a href="#mutex-是悲观锁还是乐观锁悲观锁乐观锁是什么" class="table-of-contents__link toc-highlight">Mutex 是悲观锁还是乐观锁？悲观锁、乐观锁是什么？</a></li><li><a href="#mutex-有几种模式" class="table-of-contents__link toc-highlight">Mutex 有几种模式</a></li><li><a href="#goroutine-的自旋占用资源如何解决" class="table-of-contents__link toc-highlight">goroutine 的自旋占用资源如何解决</a></li></ul></li><li><a href="#并发相关" class="table-of-contents__link toc-highlight">并发相关</a><ul><li><a href="#1怎么控制并发数" class="table-of-contents__link toc-highlight">1、怎么控制并发数？</a></li><li><a href="#2多个-goroutine-对同一个-map-写会-panic异常是否可以用-defer-捕获" class="table-of-contents__link toc-highlight">2、多个 goroutine 对同一个 map 写会 panic，异常是否可以用 defer 捕获？</a></li></ul></li><li><a href="#gc相关" class="table-of-contents__link toc-highlight">GC相关</a><ul><li><a href="#go-gc-是怎么实现的" class="table-of-contents__link toc-highlight">go gc 是怎么实现的？（</a></li><li><a href="#go-是-gc-算法是怎么实现的" class="table-of-contents__link toc-highlight">go 是 gc 算法是怎么实现的</a></li><li><a href="#gc-中-stw-时机各个阶段是如何解决的" class="table-of-contents__link toc-highlight">GC 中 stw 时机，各个阶段是如何解决的</a></li><li><a href="#gc-的触发时机" class="table-of-contents__link toc-highlight">GC 的触发时机</a></li></ul></li><li><a href="#内存相关" class="table-of-contents__link toc-highlight">内存相关</a><ul><li><a href="#谈谈内存泄露什么情况下内存会泄露怎么定位排查内存泄漏问题" class="table-of-contents__link toc-highlight">谈谈内存泄露，什么情况下内存会泄露？怎么定位排查内存泄漏问题</a></li><li><a href="#排查方式" class="table-of-contents__link toc-highlight">排查方式</a></li><li><a href="#知道-golang-的内存逃逸吗什么情况下会发生内存逃逸" class="table-of-contents__link toc-highlight">知道 golang 的内存逃逸吗？什么情况下会发生内存逃逸</a></li><li><a href="#请简述-go-是如何分配内存的" class="table-of-contents__link toc-highlight">请简述 Go 是如何分配内存的</a></li><li><a href="#channel-分配在栈上还是堆上哪些对象分配在堆上哪些对象分配在栈上" class="table-of-contents__link toc-highlight">Channel 分配在栈上还是堆上？哪些对象分配在堆上，哪些对象分配在栈上</a></li><li><a href="#介绍一下大对象小对象为什么小对象多了会造成-gc-压力" class="table-of-contents__link toc-highlight">介绍一下大对象小对象，为什么小对象多了会造成 gc 压力</a></li></ul></li><li><a href="#go-多返回值怎么实现的" class="table-of-contents__link toc-highlight">Go 多返回值怎么实现的</a></li><li><a href="#讲讲-go-中主协程如何等待其余协程退出" class="table-of-contents__link toc-highlight">讲讲 Go 中主协程如何等待其余协程退出</a></li><li><a href="#go-语言中不同的类型如何比较是否相等" class="table-of-contents__link toc-highlight">Go 语言中不同的类型如何比较是否相等</a></li><li><a href="#go-中-init-函数的特征" class="table-of-contents__link toc-highlight">Go 中 init 函数的特征</a></li><li><a href="#go-中-uintptr-和-unsafepointer-的区别" class="table-of-contents__link toc-highlight">Go 中 uintptr 和 unsafe.Pointer 的区别</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">学习笔记</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/front">前端</a></li></ul></div><div class="col footer__col"><div class="footer__title">友情链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/">Discord</a></li><li class="footer__item"><a href="https://www.5cv.top/" target="_blank" rel="noopener noreferrer" class="footer__link-item">前端导航<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">来自<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/fU3PeZUBdr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div class="footer-line"><span id="run-time"></span></div> <div>Copyright © 2023 study note, Inc. Built with opencodes. </div></div></div></div></footer></div>
<script src="/assets/js/runtime~main.0952e668.js"></script>
<script src="/assets/js/main.660c0253.js"></script>
</body>
</html>