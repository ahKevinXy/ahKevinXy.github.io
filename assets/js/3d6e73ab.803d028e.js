"use strict";(self.webpackChunkah_kevin_xy=self.webpackChunkah_kevin_xy||[]).push([[1563],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var r=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},p=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},g=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(t),g=o,m=d["".concat(l,".").concat(g)]||d[g]||u[g]||s;return t?r.createElement(m,a(a({ref:n},p),{},{components:t})):r.createElement(m,a({ref:n},p))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=t.length,a=new Array(s);a[0]=g;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[d]="string"==typeof e?e:o,a[1]=i;for(var c=2;c<s;c++)a[c]=t[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}g.displayName="MDXCreateElement"},4390:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return d}});var r=t(83117),o=t(80102),s=(t(67294),t(3905)),a=["components"],i={title:"Websocket\u4f7f\u7528",tags:["ws"],authors:"Flankx",description:"Websocket \u4f7f\u7528\u65b9\u5f0f"},l="Websocket\u4f7f\u7528",c={permalink:"/blog/2023/07/13/websocket-1",source:"@site/blog/2023/07/13/websocket-1.md",title:"Websocket\u4f7f\u7528",description:"Websocket \u4f7f\u7528\u65b9\u5f0f",date:"2023-07-13T00:00:00.000Z",formattedDate:"2023\u5e747\u670813\u65e5",tags:[{label:"ws",permalink:"/blog/tags/ws"}],readingTime:1.845,hasTruncateMarker:!1,authors:[{name:"flankx",title:"\u4f5c\u8005",url:"https://github.com/flankx",email:"137472591@qq.com",imageURL:"https://avatars.githubusercontent.com/u/30172229",key:"Flankx"}],frontMatter:{title:"Websocket\u4f7f\u7528",tags:["ws"],authors:"Flankx",description:"Websocket \u4f7f\u7528\u65b9\u5f0f"},prevItem:{title:"\u7ebf\u7a0b\u6c60\u7684\u4f7f\u7528",permalink:"/blog/2023/07/13/thread"},nextItem:{title:"\u5f00\u6e90\u7f51\u7edc\u8d27\u8fd0\u5e73\u53f0",permalink:"/blog/2023/07/11/opensource_network_freight"}},p={authorsImageUrls:[void 0]},d=[{value:"\u65b9\u5f0f1\uff1a\u539f\u751f\u6ce8\u89e3",id:"\u65b9\u5f0f1\u539f\u751f\u6ce8\u89e3",level:2},{value:"1. \u5f15\u5165<code>POM</code>\u4f9d\u8d56",id:"1-\u5f15\u5165pom\u4f9d\u8d56",level:3},{value:"2. \u914d\u7f6e\u6587\u4ef6",id:"2-\u914d\u7f6e\u6587\u4ef6",level:3},{value:"3. \u8fde\u63a5\u5904\u7406",id:"3-\u8fde\u63a5\u5904\u7406",level:3},{value:"\u65b9\u5f0f2\uff1a\u4f7f\u7528<code>Spring</code>\u5c01\u88c5",id:"\u65b9\u5f0f2\u4f7f\u7528spring\u5c01\u88c5",level:2},{value:"1. \u5f15\u5165<code>POM</code>\u4f9d\u8d56",id:"1-\u5f15\u5165pom\u4f9d\u8d56-1",level:3},{value:"2. \u7f16\u5199\u5904\u7406\u5668<code>WebsocketHandler</code>",id:"2-\u7f16\u5199\u5904\u7406\u5668websockethandler",level:3},{value:"3. \u6ce8\u518c<code>Handler</code>",id:"3-\u6ce8\u518chandler",level:3},{value:"\u65b9\u5f0f3\uff1a\u4f7f\u7528<code>STOMP</code>",id:"\u65b9\u5f0f3\u4f7f\u7528stomp",level:2},{value:"\u65b9\u5f0f4\uff1a\u4f7f\u7528<code>Netty</code> \u7b49\u5176\u4ed6\u65b9\u5f0f",id:"\u65b9\u5f0f4\u4f7f\u7528netty-\u7b49\u5176\u4ed6\u65b9\u5f0f",level:2}],u={toc:d},g="wrapper";function m(e){var n=e.components,t=(0,o.Z)(e,a);return(0,s.kt)(g,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"\u65b9\u5f0f1\u539f\u751f\u6ce8\u89e3"},"\u65b9\u5f0f1\uff1a\u539f\u751f\u6ce8\u89e3"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u76d1\u542c\u8def\u5f84\uff1a",(0,s.kt)("inlineCode",{parentName:"li"},"@ServerEndpoint")),(0,s.kt)("li",{parentName:"ul"},"\u5efa\u7acb\u8fde\u63a5\uff1a",(0,s.kt)("inlineCode",{parentName:"li"},"@OnOpen")),(0,s.kt)("li",{parentName:"ul"},"\u63a5\u6536\u6d88\u606f\uff1a",(0,s.kt)("inlineCode",{parentName:"li"},"@OnMessage")),(0,s.kt)("li",{parentName:"ul"},"\u5173\u95ed\u8fde\u63a5\uff1a",(0,s.kt)("inlineCode",{parentName:"li"},"@OnClose")),(0,s.kt)("li",{parentName:"ul"},"\u8fde\u63a5\u9519\u8bef\uff1a",(0,s.kt)("inlineCode",{parentName:"li"},"@OnError"))),(0,s.kt)("h3",{id:"1-\u5f15\u5165pom\u4f9d\u8d56"},"1. \u5f15\u5165",(0,s.kt)("inlineCode",{parentName:"h3"},"POM"),"\u4f9d\u8d56"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-websocket</artifactId>\n</dependency>\n")),(0,s.kt)("h3",{id:"2-\u914d\u7f6e\u6587\u4ef6"},"2. \u914d\u7f6e\u6587\u4ef6"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\n@EnableWebSocket\npublic class WebSocketConfig {\n @Bean\n public ServerEndpointExporter serverEndpointExporter() {\n  return new ServerEndpointExporter();\n }\n}\n")),(0,s.kt)("h3",{id:"3-\u8fde\u63a5\u5904\u7406"},"3. \u8fde\u63a5\u5904\u7406"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-java"},'@Slf4j\n@ServerEndpoint("/ws-demo")\n@Component\npublic class TestWSEndPoint {\n private static ConcurrentHashMap<String, Session> map = new ConcurrentHashMap<>();\n\n @OnOpen\n public void onOpen(Session session) {\n  log.info("\u63a5\u53d7\u8fde\u63a5: " + session);\n  map.put(session.getId(), session);\n }\n\n @OnMessage\n public void onMessage(Session session, String message) throws IOException {\n  session.getBasicRemote().sendText("\u8fd4\u56de\u54cd\u5e94\uff1a" + message);\n }\n\n @OnClose\n public void onClose(Session session) {\n  log.info("\u5173\u95ed\u8fde\u63a5: " + session);\n  map.remove(session.getId());\n }\n\n @OnError\n public void onError(Session session, Throwable throwable) throws Exception {\n  log.error("\u9519\u8bef\u8fde\u63a5: " + session + "throwable : " + throwable.getMessage());\n }\n\n}\n')),(0,s.kt)("h2",{id:"\u65b9\u5f0f2\u4f7f\u7528spring\u5c01\u88c5"},"\u65b9\u5f0f2\uff1a\u4f7f\u7528",(0,s.kt)("inlineCode",{parentName:"h2"},"Spring"),"\u5c01\u88c5"),(0,s.kt)("h3",{id:"1-\u5f15\u5165pom\u4f9d\u8d56-1"},"1. \u5f15\u5165",(0,s.kt)("inlineCode",{parentName:"h3"},"POM"),"\u4f9d\u8d56"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-websocket</artifactId>\n</dependency>\n")),(0,s.kt)("h3",{id:"2-\u7f16\u5199\u5904\u7406\u5668websockethandler"},"2. \u7f16\u5199\u5904\u7406\u5668",(0,s.kt)("inlineCode",{parentName:"h3"},"WebsocketHandler")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-java"},'@Component\n@Slf4j\npublic class WebsocketCustomHandler implements WebSocketHandler {\n @Override\n public void afterConnectionEstablished(WebSocketSession session) throws Exception {\n  log.info("\u63a5\u6536\u5230\u65b0\u7684\u8fde\u63a5" + session.getId());\n }\n\n @Override\n public void handleMessage(WebSocketSession session, WebSocketMessage<?> message) throws Exception {\n  String text = "\u63a5\u6536\u5230\u6d88\u606f\uff1a" + message.toString() + "session = " + session.getId();\n  log.info(text);\n  session.sendMessage(new TextMessage(text));\n  // session.sendMessage(new\n  // BinaryMessage(text.getBytes(StandardCharsets.UTF_8)));\n  // session.sendMessage(new PingMessage());\n  // session.sendMessage(new PongMessage());\n }\n\n @Override\n public void handleTransportError(WebSocketSession session, Throwable exception) throws Exception {\n  log.info("\u8fde\u63a5\u9519\u8bef" + exception + "session =" + session.getId());\n }\n\n @Override\n public void afterConnectionClosed(WebSocketSession session, CloseStatus closeStatus) throws Exception {\n  log.info("\u5173\u95ed\u8fde\u63a5 = " + closeStatus.toString() + "session =" + session.getId());\n }\n\n @Override\n public boolean supportsPartialMessages() {\n  // \u652f\u6301\u5206\u7247\n  return false;\n }\n}\n')),(0,s.kt)("h3",{id:"3-\u6ce8\u518chandler"},"3. \u6ce8\u518c",(0,s.kt)("inlineCode",{parentName:"h3"},"Handler")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-java"},'@Configuration\n@EnableWebSocket\npublic class SpringWebsocketCofig implements WebSocketConfigurer {\n\n @Autowired\n WebsocketCustomHandler websocketCustomHandler;\n\n @Override\n public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {\n  registry.addHandler(websocketCustomHandler, "/spring-ws").setAllowedOrigins("*");\n }\n}\n')),(0,s.kt)("h2",{id:"\u65b9\u5f0f3\u4f7f\u7528stomp"},"\u65b9\u5f0f3\uff1a\u4f7f\u7528",(0,s.kt)("inlineCode",{parentName:"h2"},"STOMP")),(0,s.kt)("h2",{id:"\u65b9\u5f0f4\u4f7f\u7528netty-\u7b49\u5176\u4ed6\u65b9\u5f0f"},"\u65b9\u5f0f4\uff1a\u4f7f\u7528",(0,s.kt)("inlineCode",{parentName:"h2"},"Netty")," \u7b49\u5176\u4ed6\u65b9\u5f0f"))}m.isMDXComponent=!0}}]);